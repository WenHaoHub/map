# 中国地图两级下钻说明

## 功能概述

本项目实现了中国地图的**两级下钻**功能：
1. **第一级**：显示中国地图，包含所有省份/直辖市/自治区
2. **第二级**：点击省份后，显示该市/省的所有区县

## 数据结构

### citys 文件夹
- 位置：`demo/public/citys/`
- 内容：包含全国所有市级行政区的地理数据
- 文件命名：`{市级代码}.json`（例如：`110100.json` 代表北京市）
- 数据特点：每个文件包含该市所有区县的边界数据

**示例**：`citys/211300.json` (朝阳市)
```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "adcode": 211302,
        "name": "双塔区",
        "level": "district"
      },
      "geometry": { ... }
    },
    {
      "type": "Feature",
      "properties": {
        "adcode": 211303,
        "name": "龙城区",
        "level": "district"
      },
      "geometry": { ... }
    }
    // ... 该市的其他区县
  ]
}
```

## 实现逻辑

### 代码结构

**数据状态**：
```javascript
data() {
  return {
    currentLevel: 'china',      // 当前层级：'china' | 'city'
    currentCityCode: null,      // 当前市代码
    breadcrumb: [...],          // 面包屑导航
  };
}
```

**核心方法**：

1. **loadChinaMap()** - 加载中国地图
   - 从 `/china.json` 加载数据
   - 显示所有省份/直辖市
   
2. **loadCityMap(adcode, name)** - 加载市级地图（显示该市所有区县）
   - 从 `/citys/{adcode}.json` 加载数据
   - 显示该市所有区县的边界
   - 参数：
     - `adcode`: 市级行政区划代码
     - `name`: 市级行政区名称

### 点击交互流程

```
用户操作                     系统响应
-------------------         -------------------
点击省份/直辖市    →        loadCityMap(adcode, name)
                            ├─ 从 /citys/{adcode}.json 加载数据
                            ├─ 注册地图: city_{adcode}
                            ├─ 更新 currentLevel = 'city'
                            └─ 添加面包屑导航

点击面包屑"中国"  →         loadChinaMap()
                            ├─ 从 /china.json 加载数据
                            ├─ 更新 currentLevel = 'china'
                            └─ 重置面包屑导航
```

### 事件处理

**handleMapClick(params)**
```javascript
handleMapClick(params) {
  if (this.currentLevel === 'china') {
    // 从中国地图点击省份/城市，下钻到该市的所有区县
    this.loadCityMap(adcode, name);
  }
  // 如果已经在市级别，不再下钻
}
```

**handleBreadcrumbClick(index)**
```javascript
handleBreadcrumbClick(index) {
  if (index === 0) {
    // 点击"中国"，返回全国地图
    this.loadChinaMap();
  }
}
```

## 使用说明

### 1. 查看全国地图
启动项目后，默认显示中国地图，可以看到所有省份/直辖市/自治区

### 2. 查看市级区县
- 点击任意省份/城市
- 系统会从 `citys` 文件夹加载该市所有区县的边界数据
- 地图会缩放到该市区域
- 顶部导航栏显示：中国 > 北京市

### 3. 返回上一级
- 点击顶部导航栏的"中国"
- 返回全国地图视图

## 提示文本

- 第一级（中国）：**点击省份/城市查看区县分布**
- 第二级（市）：**当前显示该市所有区县**

## 地图配置

- **roam**: 开启缩放和平移功能
- **zoom**: 初始缩放比例 1.2
- **label**: 显示地名标签
- **emphasis**: 鼠标悬停时高亮显示
- **tooltip**: 显示区域名称和行政区划代码

## 数据来源

- **china.json**: 中国地图，包含34个省级行政区
- **citys/*.json**: 334个市级行政区，每个文件包含该市所有区县

数据来源：阿里云 DataV 数据可视化平台（更新日期：2022-01-26）

## 注意事项

1. **数据路径**：确保 citys 文件夹已复制到 `demo/public/` 目录下
2. **文件命名**：市级代码必须与 citys 文件夹中的文件名对应
3. **性能优化**：每次下钻时重新注册地图，避免地图数据冲突
4. **错误处理**：如果数据加载失败，会显示错误提示

## 项目运行

```bash
# 进入项目目录
cd demo

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问地址
http://localhost:8081
```

## 技术栈

- Vue 2.6.14
- ECharts 5.4.3
- Axios 1.6.0
- Webpack 5.89.0
